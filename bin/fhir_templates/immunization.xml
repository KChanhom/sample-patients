  {% extends "entry.xml" %}
  {% block content %}
    <Immunization xmlns="http://hl7.org/fhir">
        <text>{{i.cvx_title}}</text>
        <subject>
            <reference value="{{pid}}"/>
        </subject>
        <date value="{{i.date}}"/>
        <vaccineType>
            <system value="{{i.cvx_system}}"/>
            <code value="{{i.cvx_id}}"/>
            <display value="{{i.cvx_title}}"/>
        </vaccineType>
        <reported value="false"/>
    {%- if i.administration_status == 'http://smartplatforms.org/terms/codes/ImmunizationAdministrationStatus#doseGiven' %}
        <refusedIndicator value="false"/>
    {%- elif i.administration_status == 'http://smartplatforms.org/terms/codes/ImmunizationAdministrationStatus#notAdministered' %}
        <refusedIndicator value="true"/>
        {%- if i.refusal_reason == 'http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#allergy' %}
        <explanation>
            <refusalReason>
                <system value="http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#"/>
                <code value="allergy"/>
                <display value="Allergy to vaccine/vaccine components, or allergy to eggs"/>
            </refusalReason>
        </explanation>
        {%- elif i.refusal_reason == 'http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#documentedImmunityOrPreviousDisease' %}
        <explanation>
            <refusalReason>
                <system value="http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#"/>
                <code value="documentedImmunityOrPreviousDisease"/>
                <display value="Documented immunity or previous disease"/>
            </refusalReason>
        </explanation>
        {%- elif i.refusal_reason == 'http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#notIndicatedPerGuidelines' %}
        <explanation>
            <refusalReason>
                <system value="http://smartplatforms.org/terms/codes/ImmunizationRefusalReason#"/>
                <code value="notIndicatedPerGuidelines"/>
                <display value="Not indicated per guidelines"/>
            </refusalReason>
        </explanation>
        {% endif %}
    {% endif %}
    </Immunization>
  {% endblock %}
